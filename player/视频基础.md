[TOC]
## 前言
* MediaInfo

[MediaInfo是一个专门查看视音频格式的工具](http://sourceforge.net/projects/mediainfo/files/binary/mediainfo-gui/)

* 网络视频播放前的流程

![](https://gitee.com/hysbtr/pic/raw/master/video_play_process.jpeg)

1. 解协议：将流媒体协议的数据，解析为标准的相应的封装格式数据。例如，采用RTMP协议传输的数据，经过解协议操作后，输出FLV格式的数据。
2. 解封装：将封装格式的数据，分离成为音频流压缩编码数据和视频流压缩编码数据。例如，FLV格式的数据，经过解封装操作后，输出H.264编码的视频码流和AAC编码的音频码流。
3. 解码：将视频/音频压缩编码数据，解码成为非压缩的视频/音频原始数据。通过解码，压缩编码的视频数据输出成为非压缩的颜色数据，例如YUV420P，RGB等等；压缩编码的音频数据输出成为非压缩的音频抽样数据，例如PCM数据。
4. 视音频同步：根据解封装模块处理过程中获取到的参数信息，同步解码出来的视频和音频数据，并将视频音频数据送至系统的显卡和声卡播放出来。

## 流媒体协议
名称 | 推出机构 | 传输层协议 | 客户端 | 目前使用领域
:---: | :---: | :---: | :---: | :---:
RTSP+RTP | IETF | TCP+UDP | VLC, WMP | IPTV
RTMP | Adobe Inc. | TCP | Flash | 互联网直播
RTMFP | Adobe Inc. | UDP | Flash | 互联网直播
MMS | Microsoft Inc. | TCP/UDP | WMP | 互联网直播+点播
HTTP | WWW+IETF | TCP | Flash | 互联网点播

## 封装格式
> 把视频数据和音频数据打包成一个文件的规范，不同的封装格式之间差距不大，各有优劣。

名称 | 推出机构 | 流媒体 | 支持的视频编码 | 支持的音频编码 | 目前使用领域
:---: | :---: | :---: | :---: | :---: | :---:
AVI | Microsoft Inc. | 不支持 | 几乎所有格式 | 几乎所有格式 | BT下载影视
MP4 | MPEG | 支持 | MPEG-2, MPEG-4, H.264, H.263等 | AAC, MPEG-1 Layers I, II, III, AC-3等 | 互联网视频网站
TS | MPEG | 支持 | MPEG-1, MPEG-2, MPEG-4, H.264 | MPEG-1 Layers I, II, III, AAC | IPTV，数字电视
FLV | Adobe Inc. | 支持 | Sorenson, VP6, H.264 | MP3, ADPCM, Linear PCM, AAC等 | 互联网视频网站
MKV | CoreCodec Inc. | 支持 | 几乎所有格式 | 几乎所有格式 | 互联网视频网站
RMVB | Real Networks Inc. | 支持 | RealVideo 8, 9, 10 | AAC, Cook Codec, RealAudio Lossless | BT下载影视

## 视频编码
> HEVC > VP9 > H.264> VP8 > MPEG4 > H.263 > MPEG2

名称 | 推出机构 | 推出时间 | 目前使用领域
:---: | :---: | :---: | :---: | :---:
HEVC(H.265) | MPEG/ITU-T | 2013 | 研发中
H.264 | MPEG/ITU-T | 2003 | 各个领域
MPEG4 | MPEG | 2001 | 不温不火
MPEG2 | MPEG | 1994 | 数字电视
VP9 | Google | 2013 | 研发中
VP8 | Google | 2008 | 不普及
VC-1 | Microsoft Inc. | 2006 | 微软平台

## 音频编码
> 音频编码的主要作用是将音频采样数据（PCM等）压缩成为音频码流，从而降低音频的数据量。
> AAC+ > MP3PRO > AAC> RealAudio > WMA > MP3

名称 | 推出机构 | 推出时间 | 目前使用领域
:---: | :---: | :---: | :---:
AAC | MPEG | 1997 |各个领域（新）
AC-3 | Dolby Inc. | 1992 | 电影
MP3 | MPEG | 1993 | 各个领域（旧
WMA | Microsoft Inc. | 1999 | 微软平台

## 直播平台参数对比
> 可以看出，直播服务普遍采用了RTMP作为流媒体协议，FLV作为封装格式，H.264作为视频编码格式，AAC作为音频编码格式。采用RTMP作为直播协议的好处在于其被Flash播放器支持。而Flash播放器如今已经安装在全球99%的电脑上，并且与浏览器结合的很好。因此这种流媒体直播平台可以实现“无插件直播”，极大的简化了客户端的操作。封装格式，视频编码，音频编码方面，无一例外的使用了FLV + H.264 + AAC的组合。FLV是RTMP使用的封装格式，H.264是当今实际应用中编码效率最高的视频编码标准，AAC则是当今实际应用中编码效率最高的音频编码标准。视频播放器方面，都使用了Flash播放器。

名称 | 协议 | 封装 | 视频编码 | 音频编码 | 播放器
:---: | :---: | :---: | :---: | :---: | :---:
CNTV | 私有
华数TV | RTMP | FLV | H.264 | AAC | Flash
六间房 | RTMP | FLV | H.264 | AAC | Flash
中国教育电视台 | RTMP | FLV | H.264 | AAC | Flash
北广传媒移动电视 | RTMP | FLV | H.264 | AAC | Flash
上海IPTV | RTSP+RTP | TS | H.264 | MP2 | 机顶盒

## 点播平台参数对比
> 点播服务普遍采用了HTTP作为流媒体协议，H.264作为视频编码格式，AAC作为音频编码格式。采用HTTP作为点播协议有以下两点优势：一方面，HTTP是基于TCP协议的应用层协议，媒体传输过程中不会出现丢包等现象，从而保证了视频的质量；另一方面，HTTP被绝大部分的Web服务器支持，因而流媒体服务机构不必投资购买额外的流媒体服务器，从而节约了开支。点播服务采用的封装格式有多种：MP4，FLV，F4V等，它们之间的区别不是很大。视频编码标准和音频编码标准是H.264和AAC。这两种标准分别是当今实际应用中编码效率最高的视频标准和音频标准。视频播放器方面，无一例外的都使用了Flash播放器。

名称 | 协议 | 封装 | 视频编码 | 音频编码 | 播放器
:---: | :---: | :---: | :---: | :---: | :---:
CNTV | HTTP | MP4 | H.264 | AAC | Flash
CNTV（部分） | RTMP | FLV | H.264 | AAC | Flash
华数TV | HTTP | MP4 | H.264 | AAC | Flash
优酷网 | HTTP | FLV | H.264 | AAC | Flash
土豆网 | HTTP | F4V | H.264 | AAC | Flash
56网 | HTTP | FLV | H.264 | AAC | Flash
音悦台 | HTTP | MP4 | H.264 | AAC |Flash
乐视网 | HTTP | FLV | H.264 | AAC | Flash
新浪视频 | HTTP | FLV | H.264 | AAC | Flash

## 分辨率
> 常见的分辨率有3840x2160 (4K), 1920x1080 (HD), 1280x720 (720P), 640x360 (360P)

## 码率
> 码率是影响视频质量最主要的参数之一。其它条件相同的情况下，码率越大，视频质量越好。
> 例如一个640x360的1Mbps的的视频的质量肯定好于一个640x360的500kbps的视频。但是不同分辨率的视频码率差别很大。例如我们很难断定一个1280x720的1Mbps的视频的质量是否高于一个640x360的500kbps的视频。

* 码率计算公式

```
码率(kbs) = 文件大小 / 视频时长
```

## BPP(每像素比特数)
BPP的计算公式如下：
```
BPP=bitrate/(framerate*reso_w*reso_h)
```
其中，bitrate是视频的码率，framerate是视频的帧率，reso_w和reso_h分别代表视频的宽和高。

> BPP的意义是视频中一个像素点的数据量。例如我们假设帧率为25fps，上文中1280x720的1Mbps的视频的BPP取值为0.043，640x360的500kbps的视频的BPP取值为0.087。下表列出了BPP，码率和常见分辨率之间的对应关系。

BPP | 640x360 | 848x480 | 1280x720 |  1920x1080
:---: | :---: | :---: | :---: | :---:
0.025 | 144 | 254 | 576 | 1296
0.05 | 288 | 508 | 1152 | 2592
0.075 | 432 | 763 | 1728 | 3888
0.1 | 576 | 1017 | 2304 | 5184
0.15 | 864 | 1526 | 3456 | 7776
0.2 | 1152 | 2035 | 4608 | 10368


