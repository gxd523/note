[TOC]

### 启动分类
##### 冷启动
* 耗时最多，衡量标准
* 流程：
	1. `Click Event`
	2. `IPC`
	3. `Process.start(创建进程)`
	4. `ActivityThread(相当于main(),程序入口)`
	5. `bindApplication(反射创建Application,调用其生命周期)`
	6. `LifeCycle(Activity的生命周期方法)`
	7. `ViewRootImpl(界面绘制)`

##### 温启动
* 速度介于冷、热启动之间
* 流程：`LifeCycle(Activity的生命周期方法)`-->`ViewRootImpl(界面绘制)`

##### 热启动
* 最快，是从后台切换到前台
* 流程：Activity.resume()

### 优化方向
> Application、Activity的生命周期

### 测量启动时间
##### adb(4.4以前，不精确)
* `adb shell am start -W 包名/category为LAUNCHER的Activity的全名`
* ThisTime：最后一个Activity启动耗时
* TotalTime：所有Activity启动耗时
* WaitTimeTime：AMS启动Activity的总耗时

##### Log(4.4以后)
* 通过关键字`Displayed`并筛选为`No Filters`

##### 手动打点
* 在`attachBaseContext()开始，第一条数据展示结束，例如在itemView.getViewTreeObserver().addOnPreviewDrawListener()，而不是`onWindowFocusChanged()`首帧时间结束

### 启动优化工具
#### traceview
* 使用方法：`Debug.startMethodTracing(path);`、`Debug.stopMethodTracing();`
* 默认在`storage`->`sdcard0`下，getExternalCacheDir() + "/demo.trace"
* 运行开销严重，整体都会变慢
* Top Down比较常用
* Wall Clock Time：真正的执行时间
* Thread Time：仅指CPU执行时间(更具参考意义)
* 橙色：系统API、绿色：自身API、蓝色：三方API
* `Total` = `Self` + `Children`

#### AspectJ
* `classpath 'com.hujiang.aspectjx:gradle-android-plugin-aspectjx:2.0.0'`
* `apply plugin: 'android-aspectjx'`
* `implementation 'org.aspectj:aspectjrt:1.8.14'`
* `Join Points`：程序运行时的执行点，可以作为切面的地方
	* 函数调用、执行
	* 获取、设置变量
	* 类的初始化
* `PointCut`：
* `Advice`：一种Hook，要插入代码的位置
	* Before：PointCut之前执行
	* After：PointCut之后执行
	* Around：PointCut之前、之后都执行

### Theme切换
* `Translucent`主题不要设置`windowBackground`
* 点击应用后，到启动第一个`Activity`，都显示第一个`Activity`的主题

