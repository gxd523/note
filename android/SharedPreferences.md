### apply()&commit()
* `commit()`：是同步提交到磁盘
* `apply()`：将修改提交到内存，再异步提交到磁盘
* `apply()`后面提交到内存的数据会覆盖前面的，一定程度提高了效率
* 如果希望立刻获取存储操作的结果，并据此做相应的其他操作，应当使用`commit()`

### 问题
* xml格式，I/O读写，全量更新
* sp文件会整个加载进内存
* 只更新一条数据，也会将内存中SP文件的全部数据写入磁盘
* 数据量大时容易引发ANR

### SP推荐实践
* 在工作线程中写入sp时，直接调用commit就可以，不必调用apply,这种情况下，commit的开销更小
* 在主线程中写入sp时，不要调用commit，要调用apply
* sp对应的文件尽量不要太大，按照模块名称去读写对应的sp文件，而不是一个整个应用都读写一个sp文件
* 当有连续的调用PutXxx方法操作时（特别是循环中），当确认不需要立即读取时，最后一次调用commit或apply即可。

## MMKV
* 通过`mmap`内存映射文件，提供一段可供随时写入的内存块，App只管往里面写数据，由操作系统负责将内存回写到文件，不必担心 crash 导致数据丢失
* 增量更新：将增量 kv 对象序列化后，append 到内存末尾
* 底层序列化/反序列化使用 protobuf 实现